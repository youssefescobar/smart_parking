<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Parking - Available Spots</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; display: flex; flex-direction: column; align-items: center; background-color: #f4f4f9; margin: 0; }
        h1 { color: #333; margin-top: 2rem; }
        #spots-container { display: flex; flex-wrap: wrap; gap: 30px; justify-content: center; padding: 30px; }
        .spot-card {
            background-color: #fff;
            border-radius: 15px;
            box-shadow: 0 6px 12px rgba(0,0,0,0.1);
            overflow: hidden;
            text-align: center;
            transition: transform 0.3s, box-shadow 0.3s;
        }
        .spot-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.15);
        }
        .spot-info {
            padding: 15px;
            font-size: 1.5rem;
            font-weight: bold;
            color: white;
        }
        .spot-info.available { background-color: #28a745; }
        .spot-info.occupied { background-color: #dc3545; }
        .spot-status { font-size: 0.9rem; font-weight: normal; margin-top: 5px; }
        .qr-code { padding: 15px; background-color: #fff; }
        .qr-code img { width: 150px; height: 150px; display: block; margin: 0 auto; }
    </style>
</head>
<body>
    <h1>Smart Parking Dashboard</h1>
    <div id="spots-container"></div>

    <script>
        async function fetchSpots() {
            try {
                const response = await fetch('/api/spots');
                if (!response.ok) throw new Error('Network response was not ok');
                const spots = await response.json();
                
                const container = document.getElementById('spots-container');
                container.innerHTML = ''; 

                spots.sort((a, b) => a.number.localeCompare(b.number)).forEach(spot => {
                    const card = document.createElement('div');
                    card.classList.add('spot-card');

                    const infoDiv = document.createElement('div');
                    infoDiv.classList.add('spot-info');
                    
                    const statusText = spot.isOccupied ? 'Occupied' : 'Available';
                    infoDiv.classList.add(statusText.toLowerCase());
                    infoDiv.innerHTML = `<div>${spot.number}</div><div class="spot-status">${statusText}</div>`;

                    const qrDiv = document.createElement('div');
                    qrDiv.classList.add('qr-code');
                    
                    const qrImg = document.createElement('img');
                    qrImg.src = `/api/qrcode/${spot.number}`;
                    qrImg.alt = `QR Code for Spot ${spot.number}`;
                    
                    qrDiv.appendChild(qrImg);
                    card.appendChild(infoDiv);
                    card.appendChild(qrDiv);
                    container.appendChild(card);
                });
            } catch (error) {
                console.error('Failed to fetch spots:', error);
                const container = document.getElementById('spots-container');
                container.innerHTML = '<p style="color: #dc3545;">Error loading spots. Is the server running? Please try again later.</p>';
            }
        }
        
        fetchSpots();
        setInterval(fetchSpots, 10000); // Refresh every 10 seconds
    </script>
</body>
</html>